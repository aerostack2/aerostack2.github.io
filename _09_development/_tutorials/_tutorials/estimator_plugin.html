<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Writing a New State Estimator Plugin &mdash; Aerostack2 1.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/config.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Writing a New Bheavior" href="behavior.html" />
    <link rel="prev" title="Writing a New Motion Controller Plugin" href="controller_plugin.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: blue" >
            <a href="../../../index.html" class="icon icon-home"> Aerostack2
             
            <img src="https://raw.githubusercontent.com/aerostack2/aerostack2.github.io/main/docs/_images/logo.png" class="logo" alt="Logo">
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../_00_getting_started/index.html">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../_00_getting_started/index.html#license-agreement">License agreement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../_00_getting_started/index.html#previous-dependencies">Previous dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../_00_getting_started/index.html#ubuntu-debian">Ubuntu (Debian)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_00_getting_started/binary_install.html">Binary Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_00_getting_started/source_install.html">Source Install</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../_00_getting_started/source_install.html#previous-dependencies">Previous dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../_00_getting_started/source_install.html#source-installation">Source Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../_00_getting_started/source_install.html#standard-build">Standard Build</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../_00_getting_started/source_install.html#build-with-as2-cli">Build with AS2 CLI</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../_01_aerostack2_concepts/index.html">Aerostack2 Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../_01_aerostack2_concepts/architecture/index.html">Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_01_aerostack2_concepts/architecture/index.html#inter-process-communication">Inter-process Communication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_01_aerostack2_concepts/architecture/index.html#platform-and-sensors">Platform and Sensors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_01_aerostack2_concepts/architecture/index.html#robotics-functions">Robotics Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_01_aerostack2_concepts/architecture/index.html#behaviors">Behaviors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_01_aerostack2_concepts/architecture/index.html#mission-control">Mission Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_01_aerostack2_concepts/architecture/index.html#applications">Applications</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../_01_aerostack2_concepts/as2_communications/index.html">Aerostack2 Inter-process Communication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_01_aerostack2_concepts/as2_communications/index.html#motion-references">Motion References</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_01_aerostack2_concepts/as2_communications/index.html#actuator-commands">Actuator Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_01_aerostack2_concepts/as2_communications/index.html#sensor-measurements">Sensor Measurements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_01_aerostack2_concepts/as2_communications/index.html#self-localization">Self Localization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_01_aerostack2_concepts/as2_communications/index.html#emergency">Emergency</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../_01_aerostack2_concepts/aerial_platforms/index.html">Aerial Platform</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../_01_aerostack2_concepts/motion_controller/index.html">Motion Controller</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_01_aerostack2_concepts/motion_controller/index.html#motion-reference-handler">Motion Reference Handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_01_aerostack2_concepts/motion_controller/index.html#control-modes">Control Modes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../_01_aerostack2_concepts/motion_controller/index.html#input-control-modes">Input Control Modes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../_01_aerostack2_concepts/motion_controller/index.html#output-control-modes">Output Control Modes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../_01_aerostack2_concepts/state_estimator/index.html">State Estimator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../_02_examples/index.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../_02_examples/index.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../_02_examples/index.html#basics-examples">Basics Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_02_examples/gazebo/index.html">Gazebo Simulator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../_02_examples/gazebo/project_gazebo/index.html">Simple Gazebo Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../_02_examples/crazyflie/index.html">Bitcraze Crazyflie</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../_02_examples/crazyflie/project_crazyflie/index.html">Simple Crazyflie Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../_02_examples/crazyflie/project_crazyflie_gates/index.html">Crazyflie Gates Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../_02_examples/dji/index.html">DJI OSDK</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../_02_examples/dji/project_dji_osdk/index.html">DJI OSDK Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../_02_examples/pixhawk/index.html">Pixhawk 4</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../_02_examples/pixhawk/project_px4_vision/index.html">PX4 Vision Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../_03_aerial_platforms/index.html">Aerial Platforms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../_03_aerial_platforms/_gazebo_simulation/index.html">Gazebo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_gazebo_simulation/index.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_gazebo_simulation/index.html#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_gazebo_simulation/index.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_gazebo_simulation/index.html#install-platform-package">Install platform package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_gazebo_simulation/index.html#install-simulation-assets">Install simulation assets</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_gazebo_simulation/index.html#aerostack2-common-interface">Aerostack2 Common Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_gazebo_simulation/index.html#control-modes">Control Modes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_gazebo_simulation/index.html#sensors">Sensors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_gazebo_simulation/index.html#gimbal">Gimbal</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_gazebo_simulation/index.html#config-simulation">Config Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_gazebo_simulation/index.html#platform-launch">Platform Launch</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../_03_aerial_platforms/_pixhawk/index.html">Pixhawk 4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_pixhawk/index.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_pixhawk/index.html#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_pixhawk/installation.html">Installation Guide</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_pixhawk/index.html#aerostack2-common-interface">Aerostack2 Common Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_pixhawk/index.html#control-modes">Control Modes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_pixhawk/index.html#sensors">Sensors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_pixhawk/index.html#platform-launch">Platform Launch</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../_03_aerial_platforms/_crazyflie/index.html">Bitcraze Crazyflie</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_crazyflie/index.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_crazyflie/index.html#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_crazyflie/index.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_crazyflie/index.html#install-platform-package">Install platform package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_crazyflie/index.html#aerostack2-common-interface">Aerostack2 Common Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_crazyflie/index.html#control-modes">Control Modes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_crazyflie/index.html#sensors">Sensors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_crazyflie/index.html#platform-launch">Platform Launch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_crazyflie/index.html#examples">Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_crazyflie/index.html#basic-example">Basic example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../_03_aerial_platforms/_ryze_tello/index.html">DJI Tello</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_ryze_tello/index.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_ryze_tello/index.html#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_ryze_tello/index.html#install-platform-package">Install platform package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_ryze_tello/index.html#aerostack2-common-interface">Aerostack2 Common Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_ryze_tello/index.html#control-modes">Control Modes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_ryze_tello/index.html#sensors">Sensors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_ryze_tello/index.html#platform-launch">Platform Launch</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../_03_aerial_platforms/_dji/index.html">DJI Matrice Series</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_dji/index.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_dji/index.html#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_dji/index.html#install-platform-package">Install platform package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_dji/index.html#setup-connection-with-dji-matrice">Setup connection with DJI Matrice</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_dji/index.html#aerostack2-common-interface">Aerostack2 Common Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_dji/index.html#control-modes">Control Modes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../_03_aerial_platforms/_dji/index.html#sensors">Sensors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../_03_aerial_platforms/_dji/index.html#platform-launch">Platform Launch</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../_04_robot_behaviors/index.html">Robot Behaviors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../_04_robot_behaviors/index.html#motion-behaviors">Motion Behaviors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../_04_robot_behaviors/index.html#perception-behaviors">Perception Behaviors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../_04_robot_behaviors/index.html#trajectory-generation-behaviors">Trajectory Generation Behaviors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../_05_as2_plugins/index.html">AS2 Plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../_05_as2_plugins/index.html#motion-controller-plugins">Motion Controller Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../_05_as2_plugins/index.html#state-estimator-plugins">State Estimator Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../_05_as2_plugins/index.html#behaviors-plugins">Behaviors Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_05_as2_plugins/index.html#motion-behaviors-plugins">Motion Behaviors Plugins</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../_06_user_interfaces/index.html">User Interfaces</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../_06_user_interfaces/_keyboard_teleoperation/index.html">Keyboard Teleoperation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_06_user_interfaces/_keyboard_teleoperation/index.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_06_user_interfaces/_keyboard_teleoperation/index.html#install-dependencies">Install dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_06_user_interfaces/_keyboard_teleoperation/index.html#interface-launch">Interface launch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_06_user_interfaces/_keyboard_teleoperation/index.html#instructions">Instructions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../_06_user_interfaces/_keyboard_teleoperation/index.html#interface-components">Interface Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../_06_user_interfaces/_keyboard_teleoperation/index.html#settings-window">Settings window</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../_06_user_interfaces/_keyboard_teleoperation/index.html#localization-window">Localization window</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../_06_user_interfaces/_keyboard_teleoperation/index.html#behavior-control">Behavior control</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../_06_user_interfaces/_alphanumeric_viewer/index.html">Alphanumeric Viewer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_06_user_interfaces/_alphanumeric_viewer/index.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_06_user_interfaces/_alphanumeric_viewer/index.html#interface-launch">Interface launch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_06_user_interfaces/_alphanumeric_viewer/index.html#instructions">Instructions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../_08_ros2_common_interfaces/index.html">ROS 2 Common Interfaces</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../_08_ros2_common_interfaces/aerial_platform/index.html">Aerial Platform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_08_ros2_common_interfaces/aerial_platform/index.html#topics">Topics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_08_ros2_common_interfaces/aerial_platform/index.html#services">Services</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../_08_ros2_common_interfaces/motion_controller/index.html">Motion Controller</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_08_ros2_common_interfaces/motion_controller/index.html#topics">Topics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../_08_ros2_common_interfaces/motion_controller/index.html#services">Services</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../_08_ros2_common_interfaces/state_estimator/index.html">State Estimator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_08_ros2_common_interfaces/state_estimator/index.html#topics">Topics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../_08_ros2_common_interfaces/behaviors/index.html">Behaviors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../_08_ros2_common_interfaces/behaviors/index.html#actions">Actions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../_08_ros2_common_interfaces/index.html#using-as2-interfaces">Using AS2 Interfaces</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../_cli/index.html">Command Line Interface (CLI)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="aerial_platform.html">Writing a New Aerial Platform</a><ul>
<li class="toctree-l4"><a class="reference internal" href="aerial_platform.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="aerial_platform.html#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="aerial_platform.html#tutorial-steps">Tutorial Steps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="controller_plugin.html">Writing a New Motion Controller Plugin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="controller_plugin.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="controller_plugin.html#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="controller_plugin.html#tutorial-steps">Tutorial Steps</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Writing a New State Estimator Plugin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tutorial-steps">Tutorial Steps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="behavior.html">Writing a New Bheavior</a><ul>
<li class="toctree-l4"><a class="reference internal" href="behavior.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="behavior.html#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="behavior.html#behavior-server">Behavior Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="behavior.html#behavior-client">Behavior Client</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../_develop_guide/index.html">Develop Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_develop_guide/index.html#developing-a-new-package">Developing a New Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_develop_guide/index.html#architecture-of-a-new-package">Architecture of a New Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_develop_guide/index.html#code-style">Code Style</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_develop_guide/index.html#test">Test</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../_api_documentation/index.html">API Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_api_documentation/index.html#aerostack2">Aerostack2</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_api_documentation/aerostack2/docs/index.html">aerostack2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_api_documentation/index.html#python-api">Python API</a><ul class="simple">
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../_11_license/index.html">License Agreement: 3-Clause BSD License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_12_citations/index.html">Citations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_13_about_and_contact/index.html">About and Contact</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: blue" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Aerostack2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Development</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Writing a New State Estimator Plugin</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/aerostack2/aerostack2.github.io/blob/main/docs/_09_development/_tutorials/_tutorials/estimator_plugin.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="writing-a-new-state-estimator-plugin">
<span id="development-tutorials-state-estimator"></span><h1>Writing a New State Estimator Plugin<a class="headerlink" href="#writing-a-new-state-estimator-plugin" title="Link to this heading"></a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id2">Overview</a></p></li>
<li><p><a class="reference internal" href="#requirements" id="id3">Requirements</a></p></li>
<li><p><a class="reference internal" href="#tutorial-steps" id="id4">Tutorial Steps</a></p></li>
</ul>
</nav>
<section id="overview">
<span id="development-tutorials-state-estimator-overview"></span><h2><a class="toc-backref" href="#id2" role="doc-backlink">Overview</a><a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>This tutorial shows how to create your own State Estimator within the AeroStack2 framework.
You may want to remember AeroStack2 <a class="reference internal" href="../../../_01_aerostack2_concepts/architecture/index.html#as2-concepts-architecture"><span class="std std-ref">Architecture</span></a> and its <a class="reference internal" href="../../../_01_aerostack2_concepts/state_estimator/index.html#as2-concepts-state-estimator"><span class="std std-ref">State Estimator</span></a>
operation.</p>
<p>This tutorial will be a walktrough of one existing estimators to easily understand its creation.
The one explained will be the mocap estimator plugin. The code used in this tutorial can be
found in <a class="reference external" href="https://github.com/aerostack2/aerostack2/tree/main/as2_state_estimator/as2_state_estimator_plugin_mocap">Github</a>.</p>
</section>
<section id="requirements">
<span id="development-tutorials-state-estimator-requirements"></span><h2><a class="toc-backref" href="#id3" role="doc-backlink">Requirements</a><a class="headerlink" href="#requirements" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>ROS 2 Humble</p></li>
<li><p>AeroStack2</p></li>
</ul>
</section>
<section id="tutorial-steps">
<span id="development-tutorials-state-estimator-steps"></span><h2><a class="toc-backref" href="#id4" role="doc-backlink">Tutorial Steps</a><a class="headerlink" href="#tutorial-steps" title="Link to this heading"></a></h2>
<section id="estimator-plugin-base">
<span id="development-tutorials-state-estimator-steps-class"></span><h3>1. Estimator Plugin Base<a class="headerlink" href="#estimator-plugin-base" title="Link to this heading"></a></h3>
<p>Following the plugin structure, all the estimators should inherit from a base class
<code class="docutils literal notranslate"><span class="pre">as2_state_estimator_plugin_base::StateEstimatorBase</span></code>. The base class provides a set of
virtual methods to override with expected controller functionality. The list of methods is
presented in the table below:</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">List of Virtual Methods</span><a class="headerlink" href="#id1" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Virtual method</p></th>
<th class="head"><p>Method description</p></th>
<th class="head"><p>Requires override?</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>on_setup()</p></td>
<td><p>Setup the estimator. Declare subscribers to estimation sources.</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>get_earth_to_map_transform()</p></td>
<td><p>Set transformation between earth and map.</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
</section>
<section id="overriden-methods">
<span id="development-tutorials-state-estimator-steps-methods"></span><h3>2. Overriden methods<a class="headerlink" href="#overriden-methods" title="Link to this heading"></a></h3>
<section id="setup">
<span id="development-tutorials-state-estimator-steps-methods-setup"></span><h4>Setup<a class="headerlink" href="#setup" title="Link to this heading"></a></h4>
<p>During the setup, mocap subscriber is created and a static transformation between <code class="docutils literal notranslate"><span class="pre">map</span></code>
and <code class="docutils literal notranslate"><span class="pre">odom</span></code> is published as null into the tf tree. In the mocap callback, the transformation
between <code class="docutils literal notranslate"><span class="pre">base_link</span></code> and <code class="docutils literal notranslate"><span class="pre">map</span></code> is received from the mation capture system and published
into the tf tree. Moreover, the speed is also estimated based on the pose information and
published into the AeroStack2 designed topic (<code class="docutils literal notranslate"><span class="pre">self_localization/twist</span></code>).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">on_setup</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">mocap_pose_sub_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node_ptr_</span><span class="o">-&gt;</span><span class="n">create_subscription</span><span class="o">&lt;</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">PoseStamped</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">        </span><span class="n">as2_names</span><span class="o">::</span><span class="n">topics</span><span class="o">::</span><span class="n">ground_truth</span><span class="o">::</span><span class="n">pose</span><span class="p">,</span><span class="w"> </span><span class="n">as2_names</span><span class="o">::</span><span class="n">topics</span><span class="o">::</span><span class="n">ground_truth</span><span class="o">::</span><span class="n">qos</span><span class="p">,</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Plugin</span><span class="o">::</span><span class="n">mocap_pose_callback</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">));</span>

<span class="w">    </span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">TransformStamped</span><span class="w"> </span><span class="n">map_to_odom</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">as2</span><span class="o">::</span><span class="n">tf</span><span class="o">::</span><span class="n">getTransformation</span><span class="p">(</span><span class="n">get_map_frame</span><span class="p">(),</span><span class="w"> </span><span class="n">get_odom_frame</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">publish_static_transform</span><span class="p">(</span><span class="n">map_to_odom</span><span class="p">);</span>

<span class="w">    </span><span class="n">has_earth_to_map_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformation between <code class="docutils literal notranslate"><span class="pre">earth</span></code> and <code class="docutils literal notranslate"><span class="pre">map</span></code> is not implemented in this example.</p>
</section>
</section>
<section id="exporting-the-plugin">
<span id="development-tutorials-state-estimator-steps-export"></span><h3>3. Exporting the plugin<a class="headerlink" href="#exporting-the-plugin" title="Link to this heading"></a></h3>
<p>Now that we have created our new estimator, we need to export it so that it would be visible
to the State Estimator Node. Plugins are loaded at runtime and if they are not visible, then our
node won’t be able to load it. In ROS 2, exporting and loading plugins is handled
by <code class="docutils literal notranslate"><span class="pre">pluginlib</span></code>.</p>
<p>To achieve that, class <code class="docutils literal notranslate"><span class="pre">as2_state_estimator_plugin_mocap::Plugin</span></code> is loaded dynamically from
<code class="docutils literal notranslate"><span class="pre">as2_state_estimator_plugin_base::StateEstimatorBase</span></code> which is the base class.</p>
<ol class="arabic simple">
<li><p>To export the controller, we need to provide two lines:</p></li>
</ol>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pluginlib/class_list_macros.hpp&gt;</span>
<span class="n">PLUGINLIB_EXPORT_CLASS</span><span class="p">(</span><span class="n">as2_state_estimator_plugin_mocap</span><span class="o">::</span><span class="n">Plugin</span><span class="p">,</span><span class="w"> </span><span class="n">as2_state_estimator_plugin_base</span><span class="o">::</span><span class="n">StateEstimatorBase</span><span class="p">)</span>
</pre></div>
</div>
<p>It is good practice to place these lines at the end of the file but technically, you can also
write at the top.</p>
<p>2. Next step would be to create plugin’s description file in the root directory of the package.
For example, <code class="docutils literal notranslate"><span class="pre">plugins.xml</span></code> file in our tutorial package. This file contains following
information:</p>
<ul class="simple">
<li><p><cite>library path</cite>: Plugin’s library name and it’s location.</p></li>
<li><p><cite>class name</cite>: Name of the class.</p></li>
<li><p><cite>class type</cite>: Type of class.</p></li>
<li><p><cite>base class</cite>: Name of the base class.</p></li>
<li><p><cite>description</cite>: Description of the plugin.</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;library</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;as2_controller_plugin_speed_controller&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;class</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;mocap::Plugin&quot;</span><span class="w"> </span><span class="na">base_class_type=</span><span class="s">&quot;as2_state_estimator_plugin_base::StateEstimatorBase&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;description&gt;</span>State<span class="w"> </span>estimator<span class="w"> </span>plugin<span class="w"> </span>for<span class="w"> </span>mocap<span class="w"> </span>optitrack.<span class="nt">&lt;/description&gt;</span>
<span class="w">    </span><span class="nt">&lt;/class&gt;</span>
<span class="nt">&lt;/library&gt;</span>
</pre></div>
</div>
<p>3. Next step would be to export plugin using <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> by using cmake function
<code class="docutils literal notranslate"><span class="pre">pluginlib_export_plugin_description_file()</span></code>. This function installs plugin description
file to share directory and sets ament indexes to make it discoverable.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">pluginlib_export_plugin_description_file</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="s">plugins.xml</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Compile and it should be registered. Next, we’ll use this plugin.</p></li>
</ol>
</section>
<section id="launching">
<span id="development-tutorials-state-estimator-steps-launch"></span><h3>4. Launching<a class="headerlink" href="#launching" title="Link to this heading"></a></h3>
<p>¿<strong>TBD</strong>?</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2023, Universidad Politécnica de Madrid.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>