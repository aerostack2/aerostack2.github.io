<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Writing a New Aerial Platform &mdash; Aerostack2 1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/config.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Writing a New Controller Plugin" href="controller_plugin.html" />
    <link rel="prev" title="Tutorials" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: blue" >
            <a href="../index.html" class="icon icon-home"> Aerostack2
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../_getting_started/index.html">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../_getting_started/index.html#install-and-build">Install and build</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_getting_started/index.html#license-agreement">License agreement</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_getting_started/index.html#previous-dependencies">Previous dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_getting_started/index.html#source-installation">Source installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_getting_started/index.html#standard-build">Standard Build</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_getting_started/index.html#build-with-as2-cli">Build with as2 CLI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../_getting_started/index.html#basic-example">Basic example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_aerostack2_concepts/index.html">Aerostack2 Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../_aerostack2_concepts/index.html#architecture">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_aerostack2_concepts/index.html#platform">Platform</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_aerostack2_concepts/index.html#controller">Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_aerostack2_concepts/index.html#state-estimator">State Estimator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_aerostack2_concepts/index.html#id1">Platform</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_aerostack2_concepts/index.html#id2">Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_aerostack2_concepts/index.html#id4">State Estimator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_aerostack2_concepts/index.html#robot-behaviors">Robot behaviors</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Writing a New Aerial Platform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tutorial-steps">Tutorial Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#abstract-class-aerial-platform">1. Abstract class, Aerial Platform</a></li>
<li class="toctree-l4"><a class="reference internal" href="#overriden-methods">2. Overriden methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#control-modes-configuration">3. Control modes configuration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="controller_plugin.html">Writing a New Controller Plugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="controller_plugin.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="controller_plugin.html#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="controller_plugin.html#tutorial-steps">Tutorial Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="controller_plugin.html#controller-plugin-base">1. Controller Plugin Base</a></li>
<li class="toctree-l4"><a class="reference internal" href="controller_plugin.html#overriden-methods">2. Overriden methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="controller_plugin.html#exporting-the-plugin">3. Exporting the plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="controller_plugin.html#controller-manager-and-configuration-files">4. Controller manager and configuration files</a></li>
<li class="toctree-l4"><a class="reference internal" href="controller_plugin.html#launching">5. Launching</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="estimator_plugin.html">Writing a New Estimator Plugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="estimator_plugin.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="estimator_plugin.html#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="estimator_plugin.html#tutorial-steps">Tutorial Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="estimator_plugin.html#estimator-plugin-base">1. Estimator Plugin Base</a></li>
<li class="toctree-l4"><a class="reference internal" href="estimator_plugin.html#overriden-methods">1. Overriden methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="estimator_plugin.html#exporting-the-plugin">1. Exporting the plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="estimator_plugin.html#launching">4. Launching</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="behavior.html">Writing a New Behavior</a><ul>
<li class="toctree-l3"><a class="reference internal" href="behavior.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="behavior.html#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="behavior.html#behavior-server">Behavior Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="behavior.html#behavior-client">Behavior Client</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_cli/index.html">CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_behaviors/index.html">Behaviors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_platforms/index.html">Aerial Platforms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../_platforms/_gazebo_simulation/index.html">Ignition Gazebo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_platforms/_gazebo_simulation/index.html#ros-gazebo-bridge">Ros-Gazebo Bridge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_platforms/_gazebo_simulation/index.html#sensors">Sensors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_platforms/_gazebo_simulation/index.html#aerial-models">Aerial models</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../_platforms/_pixhawk/index.html">PX4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_platforms/_pixhawk/index.html#aditional-dependencies">Aditional dependencies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_platforms/_pixhawk/index.html#fast-dds-gen">Fast-DDS-Gen</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_platforms/_pixhawk/index.html#pyros-genmsg">pyros-genmsg</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_platforms/_pixhawk/index.html#as2-platform-pixhawk">as2_platform_pixhawk</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_platforms/_pixhawk/index.html#px4-firmware-update">PX4 firmware update</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_platforms/_pixhawk/index.html#aditional-parameters">ADITIONAL PARAMETERS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../_platforms/_crazyflie/index.html">Bitcraze Crazyflie</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_platforms/_crazyflie/index.html#platform-setup">Platform Setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../_platforms/_ryze_tello/index.html">Ryze Tello</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_platforms/_dji/index.html">DJI Matrice Series</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_ros_common_interfaces/index.html">ROS Common interfaces</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../_ros_common_interfaces/index.html#using-as2-interfaces">Using AS2 interfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_ros_common_interfaces/index.html#topics">Topics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_ros_common_interfaces/index.html#services">Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_ros_common_interfaces/index.html#actions">Actions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_user_interfaces/index.html">User Interfaces</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../_user_interfaces/index.html#behavior-tree">Behavior Tree</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_user_interfaces/index.html#code">Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../_user_interfaces/index.html#keyboard-teleoperation">Keyboard Teleoperation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_user_interfaces/index.html#id1">Code</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_user_interfaces/temp_ws/src/as2_keyboard_teleoperation/docs/source/index.html">as2_keyboard_teleoperation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../_user_interfaces/index.html#alphanumeric-viewer">Alphanumeric Viewer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_user_interfaces/index.html#id2">Code</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_python_api/index.html">Python API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../_python_api/index.html#code">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_python_api/temp_ws/src/as2_python_api/docs/source/index.html">as2_python_api</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_python_api/temp_ws/src/as2_python_api/docs/source/about.html">About</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_python_api/temp_ws/src/as2_python_api/docs/source/examples.html">Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_python_api/temp_ws/src/as2_python_api/docs/source/api.html">API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_python_api/temp_ws/src/as2_python_api/docs/source/modules.html">as2_python_api</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_core/index.html">AS2 Core</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../_core/index.html#code">Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_core/as2_core/docs/index.html">as2_core</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_developer/index.html">Developer guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../_developer/index.html#file-style-guide">File style guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_developer/index.html#developing-a-new-package">Developing a new Package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_developer/index.html#style-tests">Style tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_developer/index.html#functional-tests">Functional tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_developer/index.html#run-tests">Run tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../_developer/index.html#package-architecture">Package architecture</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_projects/index.html">Projects</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../_projects/_project_ignition/index.html">Project Ignition</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_projects/_project_ignition/index.html#installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_projects/_project_ignition/index.html#single-drone-execution">Single drone execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_projects/_project_ignition/index.html#swarm-execution">Swarm execution</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_license/index.html">License agreement: 3-Clause BSD License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_troubleshooting/index.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../_troubleshooting/index.html#nvidia-nx">Nvidia NX</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_troubleshooting/index.html#clock-skew">Clock skew</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: blue" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Aerostack2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Writing a New Aerial Platform</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/aerostack2/aerostack2.github.io/blob/main/docs/_tutorials/aerial_platform.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="writing-a-new-aerial-platform">
<span id="writing-new-aerial-platform"></span><h1>Writing a New Aerial Platform<a class="headerlink" href="#writing-a-new-aerial-platform" title="Permalink to this heading"></a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="#overview">Overview</a></p></li>
<li><p><a class="reference internal" href="#requirements">Requirements</a></p></li>
<li><p><a class="reference internal" href="#tutorial-steps">Tutorial Steps</a></p></li>
</ul>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>This tutorial shows how to create your own Aerial Platform. To understand what is an
AeroStack2 Aerial Platform, please revisit <a class="reference internal" href="../_platforms/index.html#aerial-platforms"><span class="std std-ref">Aerial Platforms</span></a>.</p>
<p>For better understanding, this tutorial will be a walktrough of one existing platform.
Due to accesibility, <span class="xref std std-ref">ign_gazebo_platform</span> will be the chosen one. The code used in
this tutorial can be found in <a class="reference external" href="https://github.com/aerostack2/aerostack2/tree/main/as2_aerial_platforms/as2_ignition_platform">Github</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Just as a reminder, an aerial platform has two sides. One who deals with AeroStack2
communication (ROS2) and another who deals with the specific hardware platform.
Since all platforms inherit from a common parent class, the user should only focus on
how to communicate (send commands and receive data) with the platform hardware. ROS2
communication will be done by the base class, who has all the subscribers and publishers
needed in AeroStack2.</p>
</div>
</section>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>ROS 2 Humble</p></li>
<li><p>AeroStack2</p></li>
<li><p>Gazebo Ignition Fortress</p></li>
<li><p>Quadrotor Gazebo model (as2_gazebo_assets, already included within AeroStack2)</p></li>
</ul>
</section>
<section id="tutorial-steps">
<h2>Tutorial Steps<a class="headerlink" href="#tutorial-steps" title="Permalink to this heading"></a></h2>
<section id="abstract-class-aerial-platform">
<h3>1. Abstract class, Aerial Platform<a class="headerlink" href="#abstract-class-aerial-platform" title="Permalink to this heading"></a></h3>
<p>All Aerial Platforms should inherit from a common base class <code class="docutils literal notranslate"><span class="pre">as2::AerialPlatform</span></code>, an
extension of a <code class="docutils literal notranslate"><span class="pre">rclcpp::Node</span></code>. It provides the basic functionality for the platform and
is responsible for handling the platform state machine and the platform status. It also
handles the command subscriptions and the basic platform services.</p>
<p>The base class provides a set of virtual methods to implement a platform. It also offers
a group of protected attributes where the data received from the ROS2 side is received.
The list of methods is presented in the table below:</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">List of Virtual Methods</span><a class="headerlink" href="#id1" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Virtual method</p></th>
<th class="head"><p>Method description</p></th>
<th class="head"><p>Requires override?</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>configureSensors()</p></td>
<td><p>Configures the platform sensors.</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>ownSendCommand()</p></td>
<td><p>Handles how a command must be sended in a specific platform.</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>ownSetArmingState()</p></td>
<td><p>Handles how arming state has to be settled in a specific platform.</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>ownSetOffboardControl()</p></td>
<td><p>Handles how offboard mode has to be settled in a specific platform.</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>ownSetPlatformControlMode()</p></td>
<td><p>Handles how the control mode has to be settled in a specific platform.</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>ownKillSwitch()</p></td>
<td><p>Handles the platform emergency kill switch command (stop the motors inmediately).
Can not be reversed. USE WITH CAUTION.</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>ownStopPlatform()</p></td>
<td><p>Handles the platform emergency stop command. STOP means to hover as best as possible.
This hover is different from the hover in the platform control mode. And when it is
activated the platform will stop hearing commands from AS2. USE WITH CAUTION.</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>ownTakeoff()</p></td>
<td><p>Handles the platform takeoff command.</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p>ownLand()</p></td>
<td><p>Handles the platform landing command.</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>Besides, the group of protected attributes are:</p>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">List of Protected Attributes</span><a class="headerlink" href="#id2" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Attribute</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">command_pose_msg_</span></code></p></td>
<td><p>geometry_msgs::msg::PoseStamped</p></td>
<td><p>Pose msg received from <code class="docutils literal notranslate"><span class="pre">actuator_command/pose</span></code> topic interface.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">command_twist_msg_</span></code></p></td>
<td><p>geometry_msgs::msg::TwistStamped</p></td>
<td><p>Twist msg received from <code class="docutils literal notranslate"><span class="pre">actuator_command/twist</span></code> topic interface.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">command_thrust_msg_</span></code></p></td>
<td><p>as2_msgs::msg::Thrust</p></td>
<td><p>Pose msg received from <code class="docutils literal notranslate"><span class="pre">actuator_command/thrust</span></code> topic interface.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">platform_info_msg_</span></code></p></td>
<td><p>as2_msgs::msg::PlatformInfo</p></td>
<td><p>Platform information data container. Readable only.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="overriden-methods">
<h3>2. Overriden methods<a class="headerlink" href="#overriden-methods" title="Permalink to this heading"></a></h3>
<section id="class-constuctor">
<h4>Class constuctor<a class="headerlink" href="#class-constuctor" title="Permalink to this heading"></a></h4>
<p>Besides the overriden methods, it is necessary to create all the interface communication with the
hardware specific hardware. In this case, only two publishers are needed to arm and send commands
to de platform.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">IgnitionPlatform</span><span class="o">::</span><span class="n">IgnitionPlatform</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">as2</span><span class="o">::</span><span class="n">AerialPlatform</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">declare_parameter</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;cmd_vel_topic&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// Reading topic from launch argument</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">cmd_vel_topic_param</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_parameter</span><span class="p">(</span><span class="s">&quot;cmd_vel_topic&quot;</span><span class="p">).</span><span class="n">as_string</span><span class="p">();</span>

<span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">declare_parameter</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;arm_topic&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// Reading topic from launch argument</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">arm_topic_param</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_parameter</span><span class="p">(</span><span class="s">&quot;arm_topic&quot;</span><span class="p">).</span><span class="n">as_string</span><span class="p">();</span>

<span class="w">    </span><span class="n">twist_pub_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_publisher</span><span class="o">&lt;</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="o">&gt;</span><span class="p">(</span><span class="n">cmd_vel_topic_param</span><span class="p">,</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">QoS</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="w">    </span><span class="n">arm_pub_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">create_publisher</span><span class="o">&lt;</span><span class="n">std_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">arm_topic_param</span><span class="p">,</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">QoS</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="sensor-configuration">
<h4>Sensor configuration<a class="headerlink" href="#sensor-configuration" title="Permalink to this heading"></a></h4>
<p>There is no need to call this method manually. Base class will call it after instantiation.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">IgnitionPlatform::configureSensors</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Not sensors used within the platform</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this specific platform, there are no need of configure any sensors due to ros-gazebo bridge,
which is publishing directly the sensors in ROS topics.
You can find more information about this at <span class="xref std std-ref">ign_gazebo_platform</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>TDB</strong>: Reference how to use Sensors</p>
</div>
</section>
<section id="control-mode">
<h4>Control mode<a class="headerlink" href="#control-mode" title="Permalink to this heading"></a></h4>
<p>When a control mode reach this method, it can be assumed that the control mode is supported by the
platform (see <a class="reference internal" href="#control-modes-configuration">3. Control modes configuration</a>).</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="nf">IgnitionPlatform::ownSetPlatformControlMode</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">as2_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">ControlMode</span><span class="w"> </span><span class="o">&amp;</span><span class="n">control_in</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Control mode: [%s]&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">as2</span><span class="o">::</span><span class="n">control_mode</span><span class="o">::</span><span class="n">controlModeToString</span><span class="p">(</span><span class="n">control_in</span><span class="p">).</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">    </span><span class="n">control_in_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">control_in</span><span class="p">;</span><span class="w">  </span><span class="c1">// storing control mode</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>TDB</strong>: Reference how to control modes work</p>
</div>
</section>
<section id="send-command">
<h4>Send command<a class="headerlink" href="#send-command" title="Permalink to this heading"></a></h4>
<p>Twist msg received from <code class="docutils literal notranslate"><span class="pre">actuator_command/twist</span></code> topic is sent to the simulated drone. Before,
current control mode is checked to send null speed if HOVER mode is active.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="nf">IgnitionPlatform::ownSendCommand</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">control_in_</span><span class="p">.</span><span class="n">control_mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">as2_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">ControlMode</span><span class="o">::</span><span class="n">HOVER</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="w"> </span><span class="n">twist_msg</span><span class="p">;</span>
<span class="w">        </span><span class="n">twist_msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">twist_msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">y</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">twist_msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">z</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">twist_msg</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">twist_msg</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">twist_msg</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">twist_pub_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="n">twist_msg</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">twist_pub_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="n">command_twist_msg_</span><span class="p">.</span><span class="n">twist</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Notice that the sending command msg might need some transformations from the one stored in
<code class="docutils literal notranslate"><span class="pre">command_twist_msg_</span></code> attribute. In this particular example, we are not performing any
transformation since the control mode has the same reference frame that the expected by
the platform. Remember that the controller publish the command in the reference frame
specified in the platform control mode.</p>
</div>
</section>
<section id="arming">
<h4>Arming<a class="headerlink" href="#arming" title="Permalink to this heading"></a></h4>
<p>Send arming message to Gazebo simulator.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="nf">IgnitionPlatform::ownSetArmingState</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Bool</span><span class="w"> </span><span class="n">arm_msg</span><span class="p">;</span>
<span class="w">    </span><span class="n">arm_msg</span><span class="p">.</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">;</span>
<span class="w">    </span><span class="n">arm_pub_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="n">arm_msg</span><span class="p">);</span>
<span class="w">    </span><span class="n">resetCommandTwistMsg</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="offboard">
<h4>Offboard<a class="headerlink" href="#offboard" title="Permalink to this heading"></a></h4>
<p>Setting offboard mode before fly is not needed on Gazebo simulator.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="nf">IgnitionPlatform::ownSetOffboardControl</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">offboard</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">  </span><span class="c1">// Offboard not needed</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="emergency-kill-switch">
<h4>Emergency kill switch<a class="headerlink" href="#emergency-kill-switch" title="Permalink to this heading"></a></h4>
<p>Disarms the drone.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">IgnitionPlatform::ownKillSwitch</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ownSetArmingState</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="emergency-stop">
<h4>Emergency stop<a class="headerlink" href="#emergency-stop" title="Permalink to this heading"></a></h4>
<p>Sends null speed to the drone.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">IgnitionPlatform::ownStopPlatform</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="w"> </span><span class="n">twist_msg_hover</span><span class="p">;</span>
<span class="w">    </span><span class="n">twist_msg_hover</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">    </span><span class="n">twist_msg_hover</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">y</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">    </span><span class="n">twist_msg_hover</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">z</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">    </span><span class="n">twist_msg_hover</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">    </span><span class="n">twist_msg_hover</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">    </span><span class="n">twist_msg_hover</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>

<span class="w">    </span><span class="n">twist_pub_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="n">twist_msg_hover</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="takeoff">
<h4>Takeoff<a class="headerlink" href="#takeoff" title="Permalink to this heading"></a></h4>
<p>Gazebo simulator doesn’t not have a platform takeoff. Call platform takeoff here if supported.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="nf">IgnitionPlatform::ownTakeoff</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">RCLCPP_WARN</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Takeoff platform not enabled&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="land">
<h4>Land<a class="headerlink" href="#land" title="Permalink to this heading"></a></h4>
<p>Gazebo simulator doesn’t not have a platform land. Call platform land here if supported.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="nf">IgnitionPlatform::ownLand</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">RCLCPP_WARN</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Land platform not enabled&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="control-modes-configuration">
<h3>3. Control modes configuration<a class="headerlink" href="#control-modes-configuration" title="Permalink to this heading"></a></h3>
<p>Valid control modes are defined in a configuration file <code class="docutils literal notranslate"><span class="pre">control_modes.yaml</span></code>. In the case of
Gazebo simulator, only two control modes are valid:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">available_modes</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># - 0b00000000 # UNSET</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0b00010000</span><span class="w"> </span><span class="c1"># HOVER</span>
<span class="w">    </span><span class="c1"># - 0b00100100 # ACRO (p,q,r, Thrust)</span>
<span class="w">    </span><span class="c1"># - 0b00110001 # ATTITUDE with yaw ANGLE ( r,p,y , Thrust)</span>
<span class="w">    </span><span class="c1"># - 0b00110101 # ATTITUDE with yaw SPEED ( r,p, dy , Thrust)</span>
<span class="w">    </span><span class="c1"># - 0b01000000 # SPEED with yaw ANGLE in the LOCAL_FLU_FRAME</span>
<span class="w">    </span><span class="c1"># - 0b01000001 # SPEED with yaw ANGLE in the GLOBAL_ENU_FRAME</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0b01000100</span><span class="w"> </span><span class="c1"># SPEED with yaw SPEED in the LOCAL_FLU_FRAME</span>
<span class="w">    </span><span class="c1"># - 0b01000101 # SPEED with yaw SPEED in the GLOBAL_ENU_FRAME</span>
<span class="w">    </span><span class="c1"># - 0b01010000 # SPEED_IN_A_PLANE with yaw ANGLE in the LOCAL_FLU_FRAME</span>
<span class="w">    </span><span class="c1"># - 0b01010001 # SPEED_IN_A_PLANE with yaw ANGLE in the GLOBAL_ENU_FRAME</span>
<span class="w">    </span><span class="c1"># - 0b01010100 # SPEED_IN_A_PLANE with yaw SPEED in the LOCAL_FLU_FRAME</span>
<span class="w">    </span><span class="c1"># - 0b01010101 # SPEED_IN_A_PLANE with yaw SPEED in the GLOBAL_ENU_FRAME</span>
<span class="w">    </span><span class="c1"># - 0b01100001 # POSITION with yaw ANGLE in the GLOBAL_ENU_FRAME</span>
<span class="w">    </span><span class="c1"># - 0b01100101 # POSITION with yaw SPEED in the GLOBAL_ENU_FRAME</span>
<span class="w">    </span><span class="c1"># - 0b01110001 # TRAJECTORY with yaw ANGLE in the GLOBAL_ENU_FRAME</span>
<span class="w">    </span><span class="c1"># - 0b01110101 # TRAJECTORY with yaw SPEED in the GLOBAL_ENU_FRAME</span>
</pre></div>
</div>
<p>This configuration explains why no extra comprobation is performed in
<code class="docutils literal notranslate"><span class="pre">ownSetPlatformControlMode()</span></code> and why before sending commands only HOVER mode is
checked (<code class="docutils literal notranslate"><span class="pre">ownSendCommand()</span></code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>TDB</strong>: Reference how to control modes work</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2023, Universidad Politécnica de Madrid.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>